# Onco-Team Multi-Agent System Walkthrough

I have implemented the "Onco-Team" multi-agent system as requested.

## Architecture

The system consists of 3 specialized agents orchestrated to handle user queries regarding oncology prevention.

1.  **COMPANION (User-Facing)**: Handles chat, empathy, and translates technical outputs to the user.
2.  **SENTINEL (Analytical)**: Analyzes risk factors and determines the "Traffic Light" status (GREEN/YELLOW/RED).
3.  **EXECUTIVE (Operational)**: Activates only on RED status to provide concrete action plans.

## Components Implemented

### 1. Types (`types/oncoAgent.ts`)
Defined the shared JSON schema for agent communication:
-   `AgentRole`: COMPANION, SENTINEL, EXECUTIVE
-   `TrafficLight`: GREEN, YELLOW, RED, UNKNOWN
-   `AgentMessage`: The structured JSON payload exchanged between agents.

### 2. Mock Tools (`services/onco/tools.ts`)
Implemented mock versions of the requested tools:
-   `wearable_api`: Returns mock health data (steps, sleep, heart rate).
-   `federated_model`: Returns a qualitative risk score.
-   `cup_api`: Returns available appointment slots.
-   `calendar_api`: Simulates creating a calendar event.

### 3. System Prompts (`services/onco/prompts.ts`)
Created specific system prompts for each agent, including the **ROOT POLICY**:
-   No diagnosis.
-   Qualitative risk only.
-   Privacy aware.
-   Strict JSON output format.

### 4. Orchestrator (`services/onco/orchestrator.ts`)
The `runOncoTeam` function manages the conversation flow:
-   Starts with COMPANION.
-   Routes messages based on `handoff_to` fields.
-   Executes tools when requested via `tool_request`.
-   Loops until a `user_reply` is generated by the COMPANION.

### 5. UI Integration (`app/(tabs)/chatbot.tsx`)
-   Updated the Chatbot screen to call `runOncoTeam`.
-   Added a **Traffic Light Indicator** in the header to show the current risk status visually.

## How to Test

1.  Ensure your `.env` file has a valid `EXPO_PUBLIC_OPENAI_API_KEY`.
2.  Run the app.
3.  Chat with the assistant.
    -   **Low Risk**: "Mi sento bene, faccio sport." -> Should stay GREEN.
    -   **Red Flag**: "Ho notato sangue nelle urine." -> Should turn RED and trigger Executive (providing appointment slots).

## Demo Mode
To run the demo cases programmatically, you can call `runDemo()` from `services/onco/orchestrator.ts` (e.g., by adding a button or calling it on mount temporarily).
